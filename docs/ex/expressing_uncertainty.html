<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ullrika Sahlin">

<title>MVEN10 - Expressions of uncertainty - How probable is probable?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../ex/expressing_uncertainty.html">Aug 30</a></li><li class="breadcrumb-item"><a href="../ex/expressing_uncertainty.html">Exercise 1</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">MVEN10</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Aug 30</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ex/expressing_uncertainty.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Exercise 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ex/chance_belief_frequency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ex/introduction_to_quarto_and_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ex/risk_classification_ROC.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 4</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#exercise-overview" id="toc-exercise-overview" class="nav-link active" data-scroll-target="#exercise-overview">Exercise overview</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#purpose" id="toc-purpose" class="nav-link" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#content" id="toc-content" class="nav-link" data-scroll-target="#content">Content</a></li>
  <li><a href="#duration" id="toc-duration" class="nav-link" data-scroll-target="#duration">Duration</a></li>
  <li><a href="#reporting" id="toc-reporting" class="nav-link" data-scroll-target="#reporting">Reporting</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  <li><a href="#interpretation-of-words" id="toc-interpretation-of-words" class="nav-link" data-scroll-target="#interpretation-of-words">Interpretation of words</a></li>
  <li><a href="#high-and-small-risk" id="toc-high-and-small-risk" class="nav-link" data-scroll-target="#high-and-small-risk">High and small risk</a></li>
  <li><a href="#probability-scales" id="toc-probability-scales" class="nav-link" data-scroll-target="#probability-scales">Probability scales</a></li>
  <li><a href="#verbal-expressions-for-the-level-of-evidence" id="toc-verbal-expressions-for-the-level-of-evidence" class="nav-link" data-scroll-target="#verbal-expressions-for-the-level-of-evidence">Verbal expressions for the level of evidence</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Expressions of uncertainty - How probable is probable?</h1>
<p class="subtitle lead">MVEN10 Risk Assessment in Environment and Public Health</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ullrika Sahlin </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="exercise-overview" class="level2">
<h2 class="anchored" data-anchor-id="exercise-overview">Exercise overview</h2>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>We all use a wide variety of terms to indicate uncertainty - “could”, “maybe”, “possible” and so on. Can these be intepreted as numerical probabilities?</p>
</section>
<section id="purpose" class="level3">
<h3 class="anchored" data-anchor-id="purpose">Purpose</h3>
<ul>
<li><p>To show that the interpretation of verbal expressions as numerical probabilities varies between individuals and contexts</p></li>
<li><p>To demonstrate ways to standardise verbal expressions and allow the student to comment and critique these efforts</p></li>
</ul>
</section>
<section id="content" class="level3">
<h3 class="anchored" data-anchor-id="content">Content</h3>
<ul>
<li>Interpretation of words and matching to probability scales</li>
</ul>
</section>
<section id="duration" class="level3">
<h3 class="anchored" data-anchor-id="duration">Duration</h3>
<p>45 minutes</p>
</section>
<section id="reporting" class="level3">
<h3 class="anchored" data-anchor-id="reporting">Reporting</h3>
<p>Be prepared to report back at the end of the exercise.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>The origin to this exercise is from the book Teaching Probability by Jenny Gage and David Spiegelhalter.</p>
<p>EFSA’s probability scale is defined in <a href="https://efsa.onlinelibrary.wiley.com/doi/10.2903/j.efsa.2018.5122#efs25122-sec-0082-title">The principles and methods behind EFSA’s Guidance on Uncertainty Analysis in Scientific Assessment</a></p>
<p>The table with the IARC classification system is taken from <a href="https://wiki.cancer.org.au/policy/IARC_classifications">wiki.cancer.org.au/policy/IARC_classifications</a></p>
</section>
</section>
<section id="interpretation-of-words" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-of-words">Interpretation of words</h2>
<p>Read the following paragraph</p>
<blockquote class="blockquote">
<p>Arthur was worried. It was almost certain there would be a maths test today, and he hadn’t been paying much attention recently. Sally would probably get more marks than hi, but here was a distinct possibility that Zak would mess up. The weather forecast said it might rain, so took a coat, and as he walked to school he thought he was likely to meet Zak, who always played around, and could make him late. If he were late, he was certain to get into trouble. Perhaps there would be a fire drill to disrupt the test? But really there was little chance of that and it was also extremely unlikely an asteroid would hit the school. It was going to be a difficult sort of day.</p>
</blockquote>
<p>Do individually</p>
<ul>
<li><p>Underline the words or phrases that express uncertainty, such as “could”, “likely” and so on.</p></li>
<li><p>Make a list of these words, and rank them in terms of highest to lowest probability.</p></li>
<li><p>Put each word on the vertical probability scale. For example, if you think that “almost certain” is near 50% write it next to 50%.</p></li>
</ul>
<p>Collect together the responses and dicuss the ranges in opinion.</p>
</section>
<section id="high-and-small-risk" class="level2">
<h2 class="anchored" data-anchor-id="high-and-small-risk">High and small risk</h2>
<p>Read the following text</p>
<blockquote class="blockquote">
<p>Pregnant women usually have a screening test for possible problems with their foetus. A test result that shows any probability above 1 in 150 (0.6%) of having a baby with Down’s syndrome is called a “higher-risk result” of the NHS Choices website. Such women are offered an aminocentesis to confirm or rule out the diagnosis, but this procedure carries some risk of causing a miscarriage - this risk is estimated to be about 1%, and is described as a “small associated risk” by NHS Choices.</p>
</blockquote>
<p>Discuss the following questions:</p>
<ul>
<li><p>What do you think of this?</p></li>
<li><p>Why do you think this wording has been used?</p></li>
</ul>
</section>
<section id="probability-scales" class="level2">
<h2 class="anchored" data-anchor-id="probability-scales">Probability scales</h2>
<p>Let us consider a situation where the assessment question is a Yes/No question. The assessor’s uncertainty (or certainty) about the conclusion can be expressed as the <em>probability that the answer is Yes</em>.</p>
<p>Many organisations have tried to standardise terms expressing uncertainty. Below is the probabilty scale defined by the European Food Safety Authority (<a href="https://www.efsa.europa.eu/en">EFSA</a>) to harmonise the use of verbal expressions when communicating uncertainty to the public.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-approx-probscale" class="anchored">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;1: EFSAs Approximate probability scale</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Probability term</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Subjective probability range</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Additional options</th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">Almost certain</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">99-100%</td>
<td rowspan="4" style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid; vertical-align: top !important;">More likely than not: &gt;50%</td>
<td rowspan="9" style="text-align: left; vertical-align: top !important;">Unable to give any probability: range is 0-100%. Report as 'inconclusive', 'cannot conclude' or 'unknown'</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">Extremely likely</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">95-99%</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">Very likely</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">90-95%</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">Likely</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">66-90%</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">About as likely as not</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">33-66%</td>
<td rowspan="5" style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid; vertical-align: top !important;"></td>
</tr>
<tr class="even">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">Unlikely</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">10-33%</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">Very unlikely</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">5-10%</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">Extremely unlikely</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">1-5%</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">Almost impossible</td>
<td style="text-align: left; width: 10em; border-left: 1px solid; border-right: 1px solid;">0-1%</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Discuss the following questions:</p>
<ul>
<li><p>What do you think of this scale?</p></li>
<li><p>How does the scale fit with the matching between verbal expressions and probabilities made in the first exercise?</p></li>
<li><p>What do you think comes first when summarising uncertainty in the conclusion of an assessment - the quantitative or the verbal expression?</p></li>
<li><p>Why do you think it is called the approximate probability scale?</p></li>
</ul>
</section>
<section id="verbal-expressions-for-the-level-of-evidence" class="level2">
<h2 class="anchored" data-anchor-id="verbal-expressions-for-the-level-of-evidence">Verbal expressions for the level of evidence</h2>
<p>The International Agency for Research on Cancer (IARC) have devised a system of categories to evaluate the carcinogenicity of an agent to humans. An agent is classified based on scientific evidence derived from human and experimental animal studies and from mechanistic and other relevant data. The list of categories and their definition are as follows:</p>
<table class="table">
<caption>Table 2. IARC classifications of carcinogenic agents</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>Group</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Group 1</td>
<td style="text-align: left;">Carcinogenic to humans</td>
<td style="text-align: left;">Sufficient evidence of carcinogenicity OR Evidence of carcinogenicity in humans is less than sufficient but there is sufficient evidence of carcinogenicity in experimental animals and strong evidence in exposed humans that the agent acts through a relevant mechanism of carcinogenicity</td>
</tr>
<tr class="even">
<td>Group 2A</td>
<td style="text-align: left;">Probably carcinogenic to humans*</td>
<td style="text-align: left;">Limited evidence of carcinogenicity in humans and sufficient evidence of carcinogenicity in experimental animals OR Inadequate evidence of carcinogenicity in humans and sufficient evidence of carcinogenicity in experimental animals and strong evidence that the carcinogenesis is mediated by a mechanism that also operates in humans OR Limited evidence of carcinogenicity in humans, but belongs, based on mechanistic considerations, to a class of agents for which one or more members have been classified in Group 1 or Group 2A</td>
</tr>
<tr class="odd">
<td>Group 2B</td>
<td style="text-align: left;">Possibly carcinogenic to humans*</td>
<td style="text-align: left;">Limited evidence of carcinogenicity in humans and less than sufficient evidence of carcinogenicity in experimental animals OR Inadequate evidence of carcinogenicity in humans but sufficient evidence of carcinogenicity in experimental animals OR Inadequate evidence of carcinogenicity in humans and less than sufficient evidence of carcinogenicity in experimental animals, but with supporting evidence from mechanistic and other relevant data</td>
</tr>
<tr class="even">
<td>Group 3</td>
<td style="text-align: left;">Not classifiable as to its carcinogenicity to humans</td>
<td style="text-align: left;">Evidence of carcinogenicity is inadequate in humans and inadequate or limited in experimental animals OR Evidence of carcinogenicity is inadequate in humans but sufficient in experimental animals, but strong evidence that the mechanism of carcinogenicity in experimental animals does not operate in humans OR Agents that do not fall into any other group. Agents in Group 3 are not determined to be non-carcinogenic or safe overall, but often means that further research is needed.</td>
</tr>
</tbody>
</table>
<p>* <em>Footnote to the table:</em> The terms “probably carcinogenic” and “possibly carcinogenic” have no quantitative significance and are used simply as descriptors of different levels of evidence of human carcinogenicity, with probably carcinogenic signifying a higher level of evidence than possibly carcinogenic.</p>
<p>Discuss the following questions:</p>
<ul>
<li><p>How do you understand the term “probably” and “possibly” in this classification system?</p></li>
<li><p>Is there a difference between expressing the <em>level of evidence</em> and the <em>certainty about a conclusion</em></p></li>
<li><p>Suggest probabilities (or ranges of probabilities) corresponding to each group!</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The distinction between expressing the <em>level of evidence</em> and the <em>certainty about a conclusion</em> is also refereed to as indirect and direct uncertainty <a href="https://royalsocietypublishing.org/doi/10.1098/rsos.181870">see van der Bles et al.&nbsp;2019</a>. In risk assessment you will come across both these ways of expressing uncertainty. We will discuss in a later exercises how expert judgements or modelling can be used to consider indirect uncertainty when quantifying uncertainty in the conclusion.</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>