---
title: "Observe, fit and simulate"
subtitle: "MVEN10 Risk Assessment in Environment and Public Health"
author: "Ullrika Sahlin"
format: html
editor: visual
---

## Exercise overview

-   Each person is to produce and upload a report, but one can collaborate if desired.

### Background

This is a continuation from the previous exercise.

Assessors often face the task to inform a model with data that is available.

Here we want to find a suitable model for representing the data that we would have got if we had continued making more observations.

### Purpose

-   To find a suitable probability distribution for a random sample

-   To draw random numbers from the chosen probability distribution

### Content

-   Functions to fit a model to data

### Duration

minutes

### Reporting

Write a report using a qmd document and upload it on the assignment in canvas.

## Load data

Choose a data set collected in the previous exercise. You can continue with the one you worked with before or take another one.

Load the data into R.

```{r}
library(readxl)
df = read_excel(path="../files/ex7_yournames.xlsx",sheet="data")
df
```

Make a histogram of data

```{r}
library(dplyr)
library(ggplot2)

ggplot(df,aes(x=obs))+
  geom_histogram()
```

## Find a suitable model for data

We will find a suitable model for data by fiting a probability distribution to data.

Install the R-package **fitdistrplus**. This only needs to be done one time. Run the code below without the \# in front.

```{r}
#install.packages("fitdistrplus")
```

Load the R-package

```{r}
#| message: false

library(fitdistrplus)
```

### Continuous quantity

Fit a normal, lognormal and exponential distribution to data.

```{r}
fitnorm = fitdist(df$obs, distr = "norm")
fitlnorm = fitdist(df$obs, distr = "lnorm")
fitexp = fitdist(df$obs, distr = "exp")
```

Study the comparison histogram and PDF and Empirical and theoretical CDF

```{r}
plot(fitnorm)
plot(fitlnorm)
plot(fitexp)
```

Compare a goodness of fit measure - here we choose AIC. The lower AIC the better.

```{r}
fitnorm$aic
fitlnorm$aic
fitexp$aic
```

Choose the best model!

### Discrete quantity

If you have discrete data, fit a poisson and a binomial distribution to data. Note that in order to use the binomial you need to know the number of trials (parameter size).

```{r}
#| warning: false 

obsd = rbinom(20,16,0.2)

fitpois = fitdist(obsd, distr = "pois", discrete=TRUE)

fitbinom = fitdist(obsd, distr = "binom", discrete=TRUE, start= list(size = 16, prob = mean(obsd)/16), method = "qme", probs = c(0.25,0.75))


```

Study the comparison histogram and PDF and Empirical and theoretical CDF.

```{r}
plot(fitpois)
plot(fitbinom)
```

Compare a goodness of fit measure - here we choose AIC. The lower AIC the better.

```{r}
fitpois$aic
fitbinom$aic
```

Choose the best model

## Simulate

Generate a random sample from the chosen probability distribution and plot it.

### Normal

```{r}
#| warning: false
#| message: false

data.frame(x=rnorm(10^3,fitnorm$estimate["mean"],fitnorm$estimate["sd"])) %>%
  ggplot(aes(x=x)) +
  geom_histogram()
```

### Poisson

```{r}
#| warning: false
#| message: false

data.frame(x=rpois(10^3,fitpois$estimate)) %>%
  ggplot(aes(x=x)) +
  geom_histogram()
```

```{r}

```
